<?xml version="1.0" encoding="UTF-8"?>
   <!DOCTYPE mapper
             PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
             "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.project.tcat.persistence.TSGuestDAO">



	<!-- 회원 정보 수정 -->
	<update id="updateMember" parameterType="spring.project.tcat.VO.MemberVO">
		update member set
		member_pwd=#{member_pwd}, member_addr=#{member_addr},
		member_hp=#{member_hp}, member_email=#{member_email} where
		member_id=#{member_id}
	</update>

	<!-- 비밀번호확인 -->
	<select id="pwdCheck" resultType="int">
		SELECT count(*) FROM member WHERE member_id=#{strId} AND
		member_pwd=#{strPwd}
	</select>
	<!-- 아이디 확인 -->
	<select id="memberSelect" parameterType="String"
		resultType="spring.project.tcat.VO.MemberVO">
		select * from member where member_id=#{id}
	</select>

	<!-- 관람후기 갯수 -->
	<select id="comment" resultType="int">
		select count(*) from notice where notice_div = 4
		<choose>
			<when test="sDev==1">
				AND notice_num LIKE '${keyword}'
			</when>
			<when test="sDev==2">
				AND member_id LIKE '%${keyword}%'
			</when>
			<when test="sDev==3">
				AND notice_title LIKE '%${keyword}%'
			</when>
			<when test="sDev==4">
				AND contents LIKE '%${keyword}%'
			</when>
			<otherwise></otherwise>
		</choose>
	</select>
	<!-- 관람후기 출력 -->
	<select id="commentBoard" resultType="spring.project.tcat.VO.TcatBoardVO">
	
		select *
		from(
		select notice_num,perf_title,perf_image, contents,member_id,
		writedate,ROWNUM rnum
		from (
		select no.notice_num,per.perf_title,per.perf_image, no.contents,
		no.member_id, no.writedate
		from notice no, performanceInfo per
		where no.per_id LIKE per.per_id 
		and no.notice_div LIKE 4


		
		<choose>
			<when test="sDev==1">
				AND notice_num LIKE '${keyword}'
			</when>
			<when test="sDev==2">
				AND member_id LIKE '%${keyword}%'
			</when>
			<when test="sDev==3">
				AND perf_title LIKE '%${keyword}%'
			</when>
			<when test="sDev==4">
				AND contents LIKE '%${keyword}%'
			</when>
			<otherwise></otherwise>
		</choose>
		order by notice_num desc
		))
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>



	<!-- 관람후기(해당공연) 갯수 -->
	<select id="selectComment" resultType="int">
		select count(*)
		from notice no, performanceInfo per
		where no.notice_div = 4
		and no.per_id = per.per_id
		and per.perf_title =
		#{perf_title}
		<choose>
			<when test="sDev==1">
				AND notice_num LIKE '${keyword}'
			</when>
			<when test="sDev==2">
				AND member_id LIKE '%${keyword}%'
			</when>
			<when test="sDev==3">
				AND contents LIKE '%${keyword}%'
			</when>
			<otherwise></otherwise>
		</choose>
	</select>

	<!-- 관람후기 출력(해당공연) -->
	<select id="selectCommentBoard" resultType="spring.project.tcat.VO.TcatBoardVO">
		select *
		from(
		SELECT notice_num,perf_title,perf_image, contents, member_id,
		writedate,per_id,rownum rnum
		FROM(
		select no.notice_num,per.perf_title,per.perf_image, no.contents,
		no.member_id, no.writedate,per.per_id
		from notice no, performanceInfo per
		where no.per_id = per.per_id
		and no.notice_div LIKE 4
		and perf_title LIKE #{perf_title}
		<choose>
			<when test="sDev==1">
				AND notice_num LIKE '${keyword}'
			</when>
			<when test="sDev==2">
				AND member_id LIKE '%${keyword}%'
			</when>
			<when test="sDev==3">
				AND contents LIKE '%${keyword}%'
			</when>
			<otherwise></otherwise>
		</choose>
		order by notice_num desc
		))
		<![CDATA[
			WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>

	<!-- 관람 후기 한줄평 쓰기 -->
	<insert id="commentWrite" parameterType="spring.project.tcat.VO.TcatBoardVO">
		insert into
		notice(notice_num,writedate,contents,notice_div,member_id,per_id)
		values(Notice_SEQ.nextval,sysdate,#{contents},4,#{member_id},#{per_id})
	</insert>
</mapper>